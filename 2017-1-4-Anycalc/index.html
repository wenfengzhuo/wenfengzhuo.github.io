


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://wenfengzhuo.github.io/2017-1-4-Anycalc/">
      
      
        <meta name="author" content="Wenfeng Zhuo">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.2">
    
    
      
        <title>Anycalc - make everything calculable</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.dd2393d5.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.c8acc6db.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-XXXXXXXX-X","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://wenfengzhuo.github.io" title="Wenfeng" class="md-header-nav__button md-logo" aria-label="Wenfeng">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Wenfeng
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Anycalc - make everything calculable
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>Anycalc - make everything calculable</h1>
                
                <p>Anycalc is an extensible library I developed recently, which aims to let developers easily create calculators for caclulating
on customized objects rather than just numbers. To create a new calculator on customzied objects, the library requires developers
to define their own operands and operators, and the rest of things (evaluate the expressions etc.) will be taken care of by the
library.</p>
<h3 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h3>
<p>Let's define a new calculator that operates on strings. Before we use the library to implement the calculator, we have to define
some use cases for this brand-new calculator.</p>
<div class="codehilite"><pre><span></span><code>concatenation: given two strings, the calculator could concatenate the two strings.
remove: given two string s1, s2, the calculator could remove all s2 appeared in s1.
repeated: given a string s1 and a number n, the calculator could repeat s1 by n times.
... (we could define more)
</code></pre></div>


<p><strong>First Step</strong></p>
<p>With the library, we need to define our operand. Since <em>string</em> is supported by java, there is no need to create a new object.
All we need to do is use it as follows:</p>
<div class="codehilite"><pre><span></span><code>Operand&lt;String&gt; operand = new Operand&lt;String&gt;()
</code></pre></div>


<p><strong>Second Step</strong></p>
<p>Now we need to define our operators. With the use cases above, we could define the operators as follows:</p>
<div class="codehilite"><pre><span></span><code>&quot;+&quot;: concatenate two strings s1, s2. The expression will be: s1 + s2 = s1s2
&quot;-&quot;: given s1, s2, remove all s2 appeared in s1. The expression will be s1 - s2 = s3 (s3 will not contain any s2 substring)
&quot;*&quot;: given s1, n, repeated s1 by n times. The expresssion will be s1 * n = s1s1...s1 (repeat s1 n times)
</code></pre></div>


<p>Let's take the <em>repeated</em> case as example, the code will looks like the follows:</p>
<div class="codehilite"><pre><span></span><code>public class StringMultiplyOperator implements Operator&lt;String&gt; {

  @Override
  public Operand&lt;String&gt; apply(List&lt;Operand&lt;String&gt;&gt; operands) {
    assert operands.size() == 2;
    String str = operands.get(0).getValue();
    int repeatedNum = Integer.parseInt(operands.get(1).getValue());
    StringBuilder sb = new StringBuilder();
    while (repeatedNum -- &gt; 0) {
      sb.append(str);
    }
    return new Operand&lt;&gt;(sb.toString());
  }

  @Override
  public int priority() {
    return 2;
  }

  @Override
  public int numOfOperands() {
    return 2;
  }

  @Override
  public String getRep() {
    return &quot;*&quot;;
  }

}
</code></pre></div>


<p>For any operators, it should implement the four functions that is required by the library. The four functions are:</p>
<div class="codehilite"><pre><span></span><code>- apply(): define how the operator operates on the given operands
- priority(): define the priority of the operator. This is similiar to number calculator. &quot;*&quot; has higher priority than &quot;+&quot;.
- numberOfOperands(): define how many operands the operator requires. 2 means the operators is binary, so 1 means the operator is unary.
- getRep(): define the representation of each operators.
</code></pre></div>


<p><strong>Third Step</strong></p>
<p>Most of things are done now (actually, for current implementation, the library requires a <em>operator factory</em> and a customized
calculator instance. Later on, I will remove this part to make it more easier). Let's see a real example of how to use our newly
created calculators.</p>
<p><img alt="string calculators" src="http://i.imgur.com/w5yKQPS.gif" /></p>
<h3 id="how-it-works">How it works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h3>
<p>The underline principles for the library is pretty easy and straightforward. There is no fancy algorithms or third-party tools that are used by Anycalc. The library adopts the popular <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">Reverse Polish Notation</a>{:target="_blank"}, a common methodology used in computer science, to evaluate the expressions. In the library, the workflow could be represented by the following diagram:</p>
<p><img alt="Anycalc workflow" src="http://i.imgur.com/WzcMS9p.png" /></p>
<p>To make the library extensible and robust, the library leverages on some design patterns that are widely used in software development, for example, <a href="https://en.wikipedia.org/wiki/Factory_method_pattern">Factory Design Pattern</a>{:target="_blank"}. I made a diagram to show the relationship of different objects in the library.</p>
<p><img alt="Anycalc design" src="http://i.imgur.com/KvXIw2q.png" /></p>
<p>(note: Double Calculator is what we daily used calculator that works on numbers)</p>
<h3 id="future-work">Future work<a class="headerlink" href="#future-work" title="Permanent link">&para;</a></h3>
<p>There are still many things that should be improved in this library. The todo items for this library are:</p>
<div class="codehilite"><pre><span></span><code>- Dynamic scanner to automatically load new operators and operands
- Add more powerful tokenization logic for given expressions
- More unit tests to make the code robust
</code></pre></div>


<h3 id="source-code">Source code<a class="headerlink" href="#source-code" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/wenfengzhuo/anycalc">Anycalc</a>{:target="_blank"}</p>
                
                  
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>var disqus_config=function(){this.page.url="https://wenfengzhuo.github.io/2017-1-4-Anycalc/",this.page.identifier="/2017-1-4-Anycalc/"};!function(){var e=document,i=e.createElement("script");i.src="//wenfengzhuo.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script>

              
            </article>
          </div>
        </div>
      </main>
      
        

<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2020 Wenfeng Zhuo, made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank">Material for MkDocs</a>.
          </div>
        
      </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.f81b9e8b.min.js"></script>
      <script src="../assets/javascripts/bundle.23546af0.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>